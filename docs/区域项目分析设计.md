# 区域项目分析设计



#### 功能设计

1.自动汇总TODO目录下的所有文件，并将文件与《区域项目报备分析表》对比，并生成变动分析情况。

2.自动将当前《区域项目报备分析表》+时间戳形式备份到BAK目录下，以备后续使用。



#### 需解决的技术难题

1.EXCEL文件的合并单元格处理

合并单元格的主要问题在于选择合适的类库，使用openpyxl或xlwings

项目报备表有一个特点，即合并单元格均是上下进行的，并无 左右合并的情况。

##### 除了产品系列、产品大类、产品型号、存货编码、数量、备注外均为合并单元格。

2.分条目比对，确定“增删改”状态



#### 标注格式

1.是否分行，还是合并一行表示？（建议分行显示，前端以项目为范围合并单元格）

2.若分行，则用不同颜色标记，红色代表删除、蓝色代表修改、紫色代表新增。（建议选取此种方式）

若不分行，[新增] 字符串，[删除]字符串，[修改]原始：当前



#### 程序处理流程

##### 1.预处理项目报备表

拆分所有合并单元格，用合并单元格填充所有单元格，形成记录表格。（此步骤已完成）

##### 2.逐条读取处理后表格中的记录，与分析表进行比对

主要比对项目编码、产品3要素是否相同，为方便比对，应在内存中形成原始数据表。

原始数据表为汇总表，将各分项文件的记录原样复制到原始数据表中。



##### 3.根据比对情况，进行标注（修改、删除）或新增记录

分析表为对比的标准表，STD_sheet，对比可能出现的情况：

（1）扫描全部分析表未发现相同记录，通过标志位判断，直接在分析表末尾追加一条新记录，变动类型为新增，对比分析设置为追加时间。

（2）产品系列－产品大类－产品型号（用冒号作分隔符）有相同记录，存货数量有变化，判断为修改。

（3）删除1条记录，在比对完全部记录后，以分析表为范围，扫描原始数据表，如果找不到相同值，则判断为删除。

##### 4.合并同一项目的各项目要素内容

#### 区域项目分析主要流程

1.依次分解表单中的文件， 使用demerge_excel_cell函数。
2.合并分解后的文件记录，形成单一汇总文件：文件名[区域项目报备记录汇总表]
此文件名存于TODO目录下，形成TODO_FILES列表时，应自动删除“区域项目报备记录汇总表.xlsx”文件名。
3.与前期存在分析表文件进行比对
为加快比对效率，应将区域项目报备记录汇总表读入内存，使用TODO_REC_LIST列表与分析表进行对比。
对比逻辑顺序：

A：逐条扫描分析表文件，与TODO_REC_LIST对比，确认记录修改和删除（文件中有，列表中没有）的情况；

设置REC_FOUND标志位，若找到为真，进行修改；若找到为假，标记为删除（建议使用删除线进行表达，同时标注颜色）。

B：然后反向逐条扫描TODO_REC_LIST，确认增加记录情况（列表中有，文件中没有）


